<template>
  <q-page padding class="docs-input justify-center">
    <h2>Login</h2>
    <q-input v-model="credentials.email" type="email" float-label="email" ref="email"/>
    <q-input v-model="credentials.password" type="password" float-label="senha" ref="password"/>
    <q-btn color="primary" label="Entrar" @click="submit()"/>
    
    <q-btn color="white" text-color="black" label="Cadastre-se" @click="register()"/>
  </q-page>
</template>

<style scoped>

h2 {
  margin-top: 20%;
  text-align: center;
}

button {
  float: right;
  margin-top: 5%;
}

</style>

<script>
import Router from '../router';
import store from '../store';

let auth_uri = 'http://localhost:3000';

export default {
  data() {
    return {
        credentials: {
            email: '',
            password: '',
            token: '',
        }
    }
  },
  mounted() {

  },
  methods: {
    register() {
      Router.push({name: 'Cadastrar'});
    },
    login(response) {
      this.credentials.token = response.data.token;
      console.log('token: ' + this.credentials.token);
      store.commit('login', response.data);
      Router.push({name: 'Home'});
    },
    submit() {
      console.log('user: ' + this.credentials.email + ' - pass: ' + this.credentials.password);
      axios
      .post(auth_uri + '/api/users/auth', {
        email: this.credentials.email,
        password: this.credentials.password
      })
      .then(response => (this.login(response)))
      .catch(error => {
        console.log('erro: ' + error)
        if (error.response && error.response.status === 400) {
          console.log('response: ' + error.response.data.error)
          if (error.response.data.error === "Email not found.") {
            alert('Email inv√°lido');
            this.credentials.email = '';
            this.credentials.password = '';
            this.$refs.email.focus();
          } else if (error.response.data.error === "Invalid Password.") {
            alert('Senha incorreta');
            this.credentials.password = '';
            this.$refs.password.focus();
          }
          console.log(error.response)
        }
      })
    }
  }
}

</script>